<!doctype html>
<html lang='en'>
<head>
  <meta charset='utf-8'>
  <meta name='viewport' content='width=device-width, initial-scale=1'>
  <meta name='color-scheme' content='light'>
  <title>PointsPlus — Light (Exercises + Measurements)</title>
  <style>
    :root{ --bg:#f5f7fb; --card:#ffffff; --muted:#64748b; --text:#0f172a; --accent:#2563eb; --border:#e2e8f0; }
    *{box-sizing:border-box}
    html,body{margin:0;background:var(--bg)!important;color:var(--text)!important;font-family:system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
    header{position:sticky;top:0;background:var(--bg);border-bottom:1px solid var(--border);padding:12px 16px;z-index:10}
    h1{margin:0;font-size:18px}
    .container{max-width:980px;margin:0 auto;padding:16px}
    .card{background:var(--card);border:1px solid var(--border);border-radius:16px;padding:16px;box-shadow:0 2px 8px rgba(2,6,23,.06);margin:12px 0}
    .card h2{margin:0 0 8px 0;font-size:18px}
    .card h3{margin:8px 0 6px 0;font-size:16px;color:var(--accent)}
    .row{display:flex;gap:8px;flex-wrap:wrap}
    .col{flex:1;min-width:140px}
    input,select,button,textarea{width:100%;padding:12px;border-radius:12px;border:1px solid var(--border);background:#f8fafc;color:var(--text);font-size:16px}
    textarea{min-height:84px;resize:vertical}
    button.primary{background:var(--accent);color:#fff;font-weight:700;border:none}
    button.ghost{background:#fff;border:1px solid var(--border)}
    label{font-size:13px;color:var(--muted);display:block;margin-bottom:6px}
    .small{font-size:12px;color:var(--muted)}
    .tabs{position:fixed;left:0;right:0;bottom:0;background:var(--card);border-top:1px solid var(--border);display:flex}
    .tabs button{flex:1;padding:12px;border:0;background:transparent}
    .tabs button.active{color:var(--accent);font-weight:700}
    .hidden{display:none}
    .spacer{height:72px}
    table{width:100%;border-collapse:collapse;font-size:14px}
    td,th{border-bottom:1px solid var(--border);padding:8px;text-align:left;vertical-align:middle}
    th{color:var(--muted);font-weight:600}
    .qty{max-width:100px}
    .exname{min-width:160px}
    .note{min-width:200px}
  </style>
</head>
<body>
<header><h1>PointsPlus — Light</h1></header>
<div class='container'>

  <section id='tab-today' class='tab'>
    <div class='card'>
      <h2>Today</h2>
      <div class='row'>
        <div class='col'><label>Date</label><input type='date' id='today-date'></div>
        <div class='col'><label>Daily Points Target</label><input type='number' id='daily-target' placeholder='optional'></div>
      </div>
      <div class='card'>
        <h3>Meals (simple)</h3>
        <div id='meals'></div>
        <div class='row'>
          <div class='col'><button id='add-snack' class='ghost'>+ Add Snack</button></div>
          <div class='col'><button id='quick-add' class='ghost'>+ Quick Add Points</button></div>
        </div>
        <div class='row'>
          <div class='col'><div class='small'>Food points used</div><div id='today-total' class='small'>0</div></div>
          <div class='col'><div class='small' id='today-remaining'>Remaining: —</div></div>
        </div>
      </div>
    </div>
  </section>

  <section id='tab-exercise' class='tab hidden'>
    <div class='card'>
      <h2>Strength Training (7 exercises, 3 sets)</h2>
      <div class='row'>
        <div class='col'><label>Date</label><input id='ex-date' type='date'></div>
        <div class='col'><label>Session Minutes</label><input id='ex-min' type='number' min='0'></div>
        <div class='col'><label>Intensity</label>
          <select id='ex-intensity'><option>Light</option><option selected>Moderate</option><option>Vigorous</option></select>
        </div>
      </div>
      <div class='row'>
        <div class='col'><label>Session Notes</label><textarea id='ex-notes' placeholder='e.g., felt strong on bench, shorten rest times next week...'></textarea></div>
      </div>
      <table id='ex-table'>
        <thead>
          <tr>
            <th>✓</th>
            <th>Exercise</th>
            <th>Weight/Rep</th>
            <th>Set 1 Reps</th>
            <th>Set 2 Reps</th>
            <th>Set 3 Reps</th>
            <th>Notes</th>
            <th></th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
      <div class='row'>
        <div class='col'><button id='add-ex-row' class='ghost'>+ Add Exercise</button></div>
        <div class='col'><button id='save-ex' class='primary'>Save Session</button></div>
      </div>
    </div>
    <div class='card'>
      <h3>Session History</h3>
      <table id='ex-history'><thead><tr><th>Date</th><th>Exercises</th><th>Total Reps</th><th>Total Volume (lb)</th><th>Notes</th><th></th></tr></thead><tbody></tbody></table>
    </div>
  </section>

  <section id='tab-measure' class='tab hidden'>
    <div class='card'>
      <h2>Measurements (expanded)</h2>
      <div class='row'>
        <div class='col'><label>Date</label><input id='m-date' type='date'></div>
        <div class='col'><label>Neck</label><input id='m-neck' type='number' step='0.1'></div>
        <div class='col'><label>Waist</label><input id='m-waist' type='number' step='0.1'></div>
        <div class='col'><label>Hips</label><input id='m-hips' type='number' step='0.1'></div>
        <div class='col'><label>Bust/Chest</label><input id='m-bust' type='number' step='0.1'></div>
      </div>
      <div class='row'>
        <div class='col'><label>Left Bicep</label><input id='m-lbicep' type='number' step='0.1'></div>
        <div class='col'><label>Right Bicep</label><input id='m-rbicep' type='number' step='0.1'></div>
        <div class='col'><label>Left Forearm</label><input id='m-lfore' type='number' step='0.1'></div>
        <div class='col'><label>Right Forearm</label><input id='m-rfore' type='number' step='0.1'></div>
      </div>
      <div class='row'>
        <div class='col'><label>Left Thigh</label><input id='m-lthigh' type='number' step='0.1'></div>
        <div class='col'><label>Right Thigh</label><input id='m-rthigh' type='number' step='0.1'></div>
        <div class='col'><label>Left Calf</label><input id='m-lcalf' type='number' step='0.1'></div>
        <div class='col'><label>Right Calf</label><input id='m-rcalf' type='number' step='0.1'></div>
      </div>
      <div class='row'><div class='col'><button id='m-save' class='primary'>Save Measurements</button></div></div>
    </div>
    <div class='card'>
      <h3>Measurement History</h3>
      <table id='m-table'>
        <thead>
          <tr>
            <th>Date</th><th>Neck</th><th>Waist</th><th>Hips</th><th>Bust</th>
            <th>L Bi</th><th>R Bi</th><th>L Fa</th><th>R Fa</th>
            <th>L Th</th><th>R Th</th><th>L Ca</th><th>R Ca</th><th></th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </section>

  <section id='tab-settings' class='tab hidden'>
    <div class='card'>
      <h2>Settings (Start / Goals)</h2>
      <div class='row'>
        <div class='col'><label>Gender</label><select id='prof-gender'><option value='female'>Female</option><option value='male'>Male</option><option value='other'>Other</option></select></div>
        <div class='col'><label>Age</label><input id='prof-age' type='number'></div>
        <div class='col'><label>Height (ft)</label><input id='prof-h-ft' type='number'></div>
        <div class='col'><label>Height (in)</label><input id='prof-h-in' type='number'></div>
        <div class='col'><label>Current Weight (lb)</label><input id='prof-weight' type='number'></div>
        <div class='col'><label>Activity Level</label><select id='prof-activity'><option value='sedentary'>Sedentary</option><option value='sit'>Mostly sitting</option><option value='stand'>Mostly standing</option><option value='demanding'>Physically demanding</option></select></div>
      </div>
      <div class='row'><div class='col'><button id='save-profile' class='primary'>Save</button></div></div>
    </div>
    <div class='card'>
      <h3>Backup</h3>
      <div class='row'>
        <div class='col'><button id='btn-export' class='ghost'>Export JSON</button></div>
        <div class='col'><input id='file-import' type='file' accept='application/json'></div>
        <div class='col'><button id='btn-import' class='primary'>Import</button></div>
      </div>
      <div class='small'>Export creates a .json you can save. Import merges.</div>
    </div>
  </section>

</div>
<div class='spacer'></div>
<nav class='tabs'>
  <button class='active' data-tab='today'>Today</button>
  <button data-tab='exercise'>Exercise</button>
  <button data-tab='measure'>Measurements</button>
  <button data-tab='settings'>Settings</button>
</nav>

<script>
// ------- Tabs -------
(function(){
  const btns=document.querySelectorAll('.tabs button');
  function show(n){
    document.querySelectorAll('.tab').forEach(s=>s.classList.add('hidden'));
    document.getElementById('tab-'+n).classList.remove('hidden');
    btns.forEach(b=>b.classList.toggle('active', b.dataset.tab===n));
  }
  btns.forEach(b=>b.addEventListener('click', ()=>show(b.dataset.tab)));
  show('today');
})();

// ------- Simple storage helpers -------
function jget(k){ try{return JSON.parse(localStorage.getItem(k)||'null');}catch(e){return null;} }
function jset(k,v){ localStorage.setItem(k, JSON.stringify(v)); }
function jdel(k){ localStorage.removeItem(k); }

// ------- Today minimal meals -------
const mealsDiv=document.getElementById('meals'); const todayDate=document.getElementById('today-date'); const targetInput=document.getElementById('daily-target'); const todayTotal=document.getElementById('today-total'); const todayRemaining=document.getElementById('today-remaining');
function mealRow(meal,item={}){const wrap=document.createElement('div'); wrap.className='row'; wrap.innerHTML=`<div class="col"><label>${meal} - Food</label><input data-k="name" value="${item.name||''}"></div><div class="col"><label>Points</label><input data-k="points" type="number" step="1" value="${item.points||0}"></div><div class="col"><label></label><button class="ghost remove-item">Remove</button></div>`; wrap.querySelector('.remove-item').addEventListener('click',()=>{wrap.remove();updateTodayTotals();saveToday();}); return wrap;}
function renderMeals(day){mealsDiv.innerHTML=''; const mealNames=['Breakfast','Lunch','Dinner','Snack']; const by={}; mealNames.forEach(m=>by[m]=[]); (day.items||[]).forEach(it=>{by[it.meal]=by[it.meal]||[]; by[it.meal].push(it);}); mealNames.forEach(m=>{const card=document.createElement('div'); card.className='card'; card.innerHTML=`<h3>${m}</h3><div class="meal-items"></div><button class="ghost add-item">+ Add ${m} Item</button>`; const holder=card.querySelector('.meal-items'); (by[m]||[]).forEach(it=>holder.appendChild(mealRow(m,it))); card.querySelector('.add-item').addEventListener('click',()=>holder.appendChild(mealRow(m,{name:'',points:0}))); mealsDiv.appendChild(card); }); }
function readMealsUI(){const items=[]; document.querySelectorAll('#meals .card').forEach(card=>{const meal=card.querySelector('h3').textContent; card.querySelectorAll('.row').forEach(r=>{const name=r.querySelector('input[data-k=\"name\"]').value.trim(); const pts=parseFloat(r.querySelector('input[data-k=\"points\"]').value||'0'); if(name||pts) items.push({meal,name,points:pts});});}); return items;}
function updateTodayTotals(){ const items=readMealsUI(); const total=items.reduce((s,x)=>s+(+x.points||0),0); todayTotal.textContent=String(total); let target = +(targetInput.value||0); todayRemaining.textContent = 'Remaining: ' + (target - total); }
function saveToday(){ const date=todayDate.value; if(!date) return; const day={date,target:+(targetInput.value||0),items:readMealsUI()}; jset('day:'+date, day); }
function loadToday(){ const date=todayDate.value; const day = jget('day:'+date) || {date,target:0,items:[]}; targetInput.value = day.target||''; renderMeals(day); updateTodayTotals(); }
document.getElementById('add-snack').addEventListener('click',()=>{document.querySelectorAll('#meals .card').forEach(c=>{if(c.querySelector('h3').textContent==='Snack'){c.querySelector('.meal-items').appendChild(mealRow('Snack',{name:'',points:0}));}});});
document.getElementById('quick-add').addEventListener('click',()=>{const pts=parseFloat(prompt('Quick add points:','0')||'0'); if(isNaN(pts))return; document.querySelectorAll('#meals .card').forEach(c=>{if(c.querySelector('h3').textContent==='Snack'){c.querySelector('.meal-items').appendChild(mealRow('Snack',{name:'Quick Add',points:pts}));}}); updateTodayTotals();});
todayDate.addEventListener('change', loadToday);
mealsDiv.addEventListener('input',(e)=>{if(e.target.tagName==='INPUT'){updateTodayTotals();saveToday();}});
targetInput.addEventListener('input',()=>{updateTodayTotals();saveToday();});

// ------- Strength training (7 rows, 3 sets each) + completed + notes -------
function exRow(pref={done:false,ex:'',wt:0,r1:0,r2:0,r3:0,notes:''}){
  const tr=document.createElement('tr');
  tr.innerHTML = `<td><input type='checkbox' data-k='done' ${pref.done?'checked':''}/></td>
    <td><input class='exname' data-k='ex' value='${pref.ex||''}'/></td>
    <td><input class='qty' data-k='wt' type='number' step='0.1' value='${pref.wt||0}'/></td>
    <td><input class='qty' data-k='r1' type='number' step='1' value='${pref.r1||0}'/></td>
    <td><input class='qty' data-k='r2' type='number' step='1' value='${pref.r2||0}'/></td>
    <td><input class='qty' data-k='r3' type='number' step='1' value='${pref.r3||0}'/></td>
    <td><input class='note' data-k='notes' placeholder='notes' value='${pref.notes or ""}'/></td>
    <td><button class='ghost del'>X</button></td>`;
  tr.querySelector('.del').addEventListener('click',()=>tr.remove());
  return tr;
}
const exTbody=document.querySelector('#ex-table tbody');
function ensureSevenRows(){
  const need = 7 - exTbody.querySelectorAll('tr').length;
  for(let i=0;i<need;i++){ exTbody.appendChild(exRow({ex:'',wt:0,r1:0,r2:0,r3:0, notes:''})); }
}
document.getElementById('add-ex-row').addEventListener('click',()=>exTbody.appendChild(exRow({})));
document.getElementById('save-ex').addEventListener('click',()=>{
  const date=document.getElementById('ex-date').value;
  if(!date){ alert('Pick a date'); return; }
  const rows=[...exTbody.querySelectorAll('tr')].map(tr=>{
    const g=k=>tr.querySelector(`[data-k="${k}"]`);
    return {done: !!g('done')?.checked, ex:g('ex')?.value||'', wt:+(g('wt')?.value||0), r1:+(g('r1')?.value||0), r2:+(g('r2')?.value||0), r3:+(g('r3')?.value||0), notes: g('notes')?.value||''};
  }).filter(r=>r.ex || r.r1 || r.r2 || r.r3 || r.done || r.notes);
  const sess={date, minutes:+(document.getElementById('ex-min').value||0), intensity:(document.getElementById('ex-intensity').value||'Moderate'), session_notes: (document.getElementById('ex-notes').value||''), rows};
  jset('lifts:'+date, sess);
  loadExHistory();
  alert('Session saved.');
});
function loadExFor(date){
  const sess=jget('lifts:'+date);
  exTbody.innerHTML='';
  if(sess && Array.isArray(sess.rows)){ sess.rows.forEach(r=>exTbody.appendChild(exRow(r))); }
  ensureSevenRows();
}
function shorten(s, n){ if(!s) return ''; return s.length>n? s.slice(0,n-1)+'…' : s; }
function loadExHistory(){
  const keys=Object.keys(localStorage).filter(k=>k.startsWith('lifts:')).sort();
  const tb=document.querySelector('#ex-history tbody'); tb.innerHTML='';
  keys.forEach(k=>{
    const s=jget(k); if(!s) return;
    const totals=s.rows.reduce((acc,r)=>{ const reps=(+r.r1||0)+(+r.r2||0)+(+r.r3||0); acc.ex+=1; acc.reps+=reps; acc.vol+=reps*(+r.wt||0); return acc; }, {ex:0,reps:0,vol:0});
    const tr=document.createElement('tr');
    tr.innerHTML = `<td>${s.date}</td><td>${totals.ex}</td><td>${totals.reps}</td><td>${totals.vol}</td><td title="${(s.session_notes||'').replace(/"/g,'&quot;')}">${shorten(s.session_notes||'', 60)}</td><td><button class='ghost' data-del='${s.date}'>Delete</button></td>`;
    tb.appendChild(tr);
  });
  tb.querySelectorAll('button[data-del]').forEach(b=>b.addEventListener('click',()=>{ jdel('lifts:'+b.dataset.del); loadExHistory(); }));
}

// ------- Measurements (expanded) -------
document.getElementById('m-save').addEventListener('click', ()=>{
  const d=document.getElementById('m-date').value; if(!d){alert('Pick a date');return;}
  const obj={date:d,
    neck:+(document.getElementById('m-neck').value||0),
    waist:+(document.getElementById('m-waist').value||0),
    hips:+(document.getElementById('m-hips').value||0),
    bust:+(document.getElementById('m-bust').value||0),
    lbicep:+(document.getElementById('m-lbicep').value||0),
    rbicep:+(document.getElementById('m-rbicep').value||0),
    lfore:+(document.getElementById('m-lfore').value||0),
    rfore:+(document.getElementById('m-rfore').value||0),
    lthigh:+(document.getElementById('m-lthigh').value||0),
    rthigh:+(document.getElementById('m-rthigh').value||0),
    lcalf:+(document.getElementById('m-lcalf').value||0),
    rcalf:+(document.getElementById('m-rcalf').value||0)
  };
  const rows=(jget('measures')||[]).filter(x=>x.date!==d);
  rows.push(obj); rows.sort((a,b)=>(a.date||'').localeCompare(b.date||''));
  jset('measures', rows);
  loadMeasures();
  alert('Measurements saved.');
});
function loadMeasures(){
  const rows=jget('measures')||[];
  const tb=document.querySelector('#m-table tbody'); tb.innerHTML='';
  rows.forEach(r=>{
    const tr=document.createElement('tr');
    tr.innerHTML = `<td>${r.date}</td><td>${r.neck||0}</td><td>${r.waist||0}</td><td>${r.hips||0}</td><td>${r.bust||0}</td>
                    <td>${r.lbicep||0}</td><td>${r.rbicep||0}</td><td>${r.lfore||0}</td><td>${r.rfore||0}</td>
                    <td>${r.lthigh||0}</td><td>${r.rthigh||0}</td><td>${r.lcalf||0}</td><td>${r.rcalf||0}</td>
                    <td><button class='ghost' data-del='${r.date}'>Delete</button></td>`;
    tb.appendChild(tr);
  });
  tb.querySelectorAll('button[data-del]').forEach(b=>b.addEventListener('click',()=>{
    const date=b.dataset.del;
    const rows=(jget('measures')||[]).filter(x=>x.date!==date);
    jset('measures', rows);
    loadMeasures();
  }));
}

// ------- Settings / Profile -------
document.getElementById('save-profile').addEventListener('click', ()=>{
  const p={ gender:document.getElementById('prof-gender').value,
            age:+(document.getElementById('prof-age').value||0),
            h_ft:+(document.getElementById('prof-h-ft').value||0),
            h_in:+(document.getElementById('prof-h-in').value||0),
            weight:+(document.getElementById('prof-weight').value||0),
            activity:document.getElementById('prof-activity').value };
  jset('profile', p);
  alert('Saved.');
});

// ------- Backup (export/import) -------
document.getElementById('btn-export').addEventListener('click', ()=>{
  const keys=['profile']; const all={};
  // days
  Object.keys(localStorage).forEach(k=>{ if(k.startsWith('day:')) keys.push(k); });
  // lifts
  Object.keys(localStorage).forEach(k=>{ if(k.startsWith('lifts:')) keys.push(k); });
  // measures
  keys.push('measures');
  keys.forEach(k=>{ all[k] = jget(k); });
  const blob=new Blob([JSON.stringify(all,null,2)], {type:'application/json'});
  const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download='tracker_backup.json'; a.click();
});
document.getElementById('btn-import').addEventListener('click', async ()=>{
  const inp=document.getElementById('file-import'); if(!inp.files||!inp.files[0]){ alert('Choose a JSON file first.'); return; }
  const text=await inp.files[0].text(); const obj=JSON.parse(text);
  Object.entries(obj).forEach(([k,v])=>{ jset(k,v); });
  loadMeasures(); loadExHistory(); loadToday();
  alert('Import complete.');
});

// ------- Init -------
(function(){
  const today=new Date().toISOString().slice(0,10);
  ['today-date','ex-date','m-date'].forEach(id=>{ const el=document.getElementById(id); if(el) el.value = today; });
  loadToday();
  loadExFor(today);
  loadExHistory();
  loadMeasures();
})();
</script>
</body>
</html>
